<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>èœå•å±•ç¤º</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            flex-direction: column;
        }

        .slider {
            width: 90vw;
            height: 95vh;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .slider img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            cursor: pointer;
            touch-action: none;
        }

        .slider img.active {
            opacity: 1;
        }

        /* ç¼©æ”¾å…³é—­æŒ‰é’® */
        .zoom-close-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .zoom-close-btn.show {
            display: flex;
        }

        .zoom-close-btn:active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(0.9);
        }

        .zoom-close-btn::before,
        .zoom-close-btn::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 3px;
            background-color: #fff;
            border-radius: 2px;
        }

        .zoom-close-btn::before {
            transform: rotate(45deg);
        }

        .zoom-close-btn::after {
            transform: rotate(-45deg);
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-image {
            width: auto;
            height: auto;
            max-width: 95vw;
            max-height: 95vh;
            object-fit: contain;
            touch-action: none;
            will-change: transform;
            transform-origin: center center;
        }

        .modal-image.no-transition {
            transition: none;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            background-color: rgba(0, 0, 0, 0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .zoom-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 14px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1001;
        }

        /* é¡µç æŒ‡ç¤ºå™¨ */
        .page-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px 24px;
            border-radius: 25px;
            font-size: 15px;
            cursor: pointer;
            z-index: 998;
            user-select: none;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            white-space: nowrap;
            max-width: 90vw;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .page-indicator:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateX(-50%) scale(1.05);
        }

        .page-indicator:active {
            transform: translateX(-50%) scale(0.95);
        }

        /* è·³è½¬é¢æ¿ */
        .jump-panel {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.85));
            padding: 20px 15px 30px;
            z-index: 999;
            transition: bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            display: flex;
            flex-direction: column;
        }

        .jump-panel.show {
            bottom: 0;
        }

        .jump-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 5px;
            flex-shrink: 0;
        }

        .jump-panel-title {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }

        .jump-panel-close {
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .jump-panel-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .jump-panel-close:active {
            transform: scale(0.9);
        }

        .jump-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 5px;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(2 * 60px + 12px);
            -webkit-overflow-scrolling: touch;
        }

        .jump-item {
            height: 60px;
            padding: 10px 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            text-align: center;
            word-break: break-word;
            line-height: 1.2;
        }

        .jump-item:hover {
            background-color: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .jump-item:active {
            transform: scale(0.95);
        }

        .jump-item.current {
            background-color: rgba(66, 153, 225, 0.8);
            border-color: rgba(66, 153, 225, 1);
            box-shadow: 0 0 15px rgba(66, 153, 225, 0.5);
        }

        /* é®ç½©å±‚ */
        .jump-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .jump-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .jump-grid::-webkit-scrollbar {
            width: 6px;
        }

        .jump-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .jump-grid::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .jump-grid::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
<div class="slider" id="slider"></div>

<!-- ç¼©æ”¾å…³é—­æŒ‰é’® -->
<div class="zoom-close-btn" id="zoomCloseBtn"></div>

<!-- é¡µç æŒ‡ç¤ºå™¨ -->
<div class="page-indicator" id="pageIndicator">1/1</div>

<!-- è·³è½¬é®ç½©å±‚ -->
<div class="jump-overlay" id="jumpOverlay"></div>

<!-- è·³è½¬é¢æ¿ -->
<div class="jump-panel" id="jumpPanel">
    <div class="jump-panel-header">
        <div class="jump-panel-title">é€‰æ‹©å›¾ç‰‡</div>
        <div class="jump-panel-close" id="jumpPanelClose">&times;</div>
    </div>
    <div class="jump-grid" id="jumpGrid"></div>
</div>

<!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
<div class="modal" id="imageModal">
    <span class="close-btn" id="closeBtn">&times;</span>
    <div class="modal-content">
        <img class="modal-image" id="modalImage" src="" alt="">
    </div>
    <div class="zoom-hint">åŒæŒ‡ç¼©æ”¾æŸ¥çœ‹</div>
</div>

<script>
    const username = "loveailong";   // ğŸ‘ˆ ä¿®æ”¹ä¸ºä½ çš„ GitHub ç”¨æˆ·å
    const repo = "menu2";             // ğŸ‘ˆ ä¿®æ”¹ä¸ºä½ çš„ä»“åº“å
    const folder = "images";         // ğŸ‘ˆ å›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹å


    //ä¿®æ”¹
    // å›¾ç‰‡åç§°é…ç½®ï¼ˆå¯éšæ—¶ä¿®æ”¹ï¼‰
    const imageNames = [
        "1_ENTRÃ‰ES", "2_SOUPE_(2)", "3_SOUPE_VIANDES_SPECIALES_&_SALADES",
        "4_OMELETTE_&_RIZ_CANTONAIS", "5_RIZ_CANTONAIS_&_CHOWMING_ET_SPAGHETTIS",
        "6_CHOWMING_ET_SPAGHETTIS_&_SPAGHETTIS", "7_LÃ‰GUMES_&_CANARD",
        "8_PORT", "9_POULET_&_BOEUF", "10_CREVETTES", "11_PLAQUE_CHAUFFANTE_&_PLATS",
        "12_FILETS_DE_POISSON", "13_CALAMARS", "14_BOISSONS",
        "15_VINS_ET_SPIRITUEUX", "16_DESSERT"

    ];

    let index = 0;
    let images = [];
    let timer;

    async function loadImages() {
        const url = `https://api.github.com/repos/${username}/${repo}/contents/${folder}`;
        const response = await fetch(url);
        const files = await response.json();
        const slider = document.getElementById("slider");

        images = files
            .filter(file => file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i))
            .map(file => file.download_url);

        if (images.length === 0) {
            slider.innerHTML = "<p style='color:white'>æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡</p>";
            return;
        }

        images.forEach((imgUrl, i) => {
            const img = document.createElement("img");
            img.src = imgUrl;
            if (i === 0) img.classList.add("active");
            slider.appendChild(img);
        });

        // åˆå§‹åŒ–é¡µç å’Œè·³è½¬åŠŸèƒ½
        updatePageIndicator();
        initJumpPanel();
        setupJumpPanelEvents();

        startAutoPlay();
        setupImageViewer();
    }

    function showImage(newIndex) {
        const sliderImgs = document.querySelectorAll(".slider img");
        if (sliderImgs.length === 0) return;

        // é‡ç½®ç¼©æ”¾
        if (window.resetSliderZoom) {
            window.resetSliderZoom();
        }

        sliderImgs[index].classList.remove("active");
        sliderImgs[index].style.transform = "";

        index = (newIndex + images.length) % images.length;
        sliderImgs[index].classList.add("active");

        // æ›´æ–°é¡µç æ˜¾ç¤º
        updatePageIndicator();
    }

    function updatePageIndicator() {
        const pageIndicator = document.getElementById("pageIndicator");
        if (pageIndicator && images.length > 0) {
            const currentName = imageNames[index] || `å›¾ç‰‡${index + 1}`;
            pageIndicator.textContent = `${currentName} (${index + 1}/${images.length})`;
        }
    }

    function initJumpPanel() {
        const jumpGrid = document.getElementById("jumpGrid");
        jumpGrid.innerHTML = "";

        for (let i = 0; i < images.length; i++) {
            const item = document.createElement("div");
            item.className = "jump-item";

            // ä½¿ç”¨é…ç½®çš„åå­—æˆ–é»˜è®¤åå­—
            const name = imageNames[i] || `å›¾ç‰‡${i + 1}`;
            item.textContent = name;
            item.dataset.index = i;

            item.addEventListener("click", () => {
                showImage(i);
                closeJumpPanel();
                resetTimer();
            });

            jumpGrid.appendChild(item);
        }

        updateJumpGrid();
    }

    function updateJumpGrid() {
        const items = document.querySelectorAll(".jump-item");
        items.forEach((item, i) => {
            if (i === index) {
                item.classList.add("current");
            } else {
                item.classList.remove("current");
            }
        });
    }

    function openJumpPanel() {
        const jumpPanel = document.getElementById("jumpPanel");
        const jumpOverlay = document.getElementById("jumpOverlay");

        jumpPanel.classList.add("show");
        jumpOverlay.classList.add("show");
        updateJumpGrid();

        // æš‚åœè½®æ’­
        clearInterval(timer);
    }

    function closeJumpPanel() {
        const jumpPanel = document.getElementById("jumpPanel");
        const jumpOverlay = document.getElementById("jumpOverlay");

        jumpPanel.classList.remove("show");
        jumpOverlay.classList.remove("show");
    }

    function setupJumpPanelEvents() {
        const pageIndicator = document.getElementById("pageIndicator");
        const jumpPanelClose = document.getElementById("jumpPanelClose");
        const jumpOverlay = document.getElementById("jumpOverlay");

        // ç‚¹å‡»é¡µç æŒ‡ç¤ºå™¨æ‰“å¼€è·³è½¬é¢æ¿
        pageIndicator.addEventListener("click", openJumpPanel);

        // ç‚¹å‡»å…³é—­æŒ‰é’®
        jumpPanelClose.addEventListener("click", () => {
            closeJumpPanel();
            startAutoPlay(); // æ¢å¤è½®æ’­
        });

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        jumpOverlay.addEventListener("click", () => {
            closeJumpPanel();
            startAutoPlay(); // æ¢å¤è½®æ’­
        });
    }

    function startAutoPlay() {
        timer = setInterval(() => showImage(index + 1), 6000);
    }

    function resetTimer() {
        clearInterval(timer);
        startAutoPlay();
    }

    // è®¡ç®—ä¸¤ç‚¹è·ç¦»
    function getDistance(touch1, touch2) {
        const dx = touch1.clientX - touch2.clientX;
        const dy = touch1.clientY - touch2.clientY;
        return Math.sqrt(dx * dx + dy * dy);
    }

    function setupImageViewer() {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        const closeBtn = document.getElementById("closeBtn");
        const slider = document.getElementById("slider");
        const zoomCloseBtn = document.getElementById("zoomCloseBtn");

        // ===== è½®æ’­åŒºåŸŸå˜é‡ =====
        let sliderScale = 1;
        let sliderTranslateX = 0;
        let sliderTranslateY = 0;
        let sliderLastDistance = 0;
        let sliderIsPinching = false;
        let sliderIsDragging = false;
        let sliderHasDragged = false; // è®°å½•æœ¬æ¬¡è§¦æ‘¸æ˜¯å¦æ‹–åŠ¨è¿‡
        let sliderLastTap = 0; // è®°å½•ä¸Šæ¬¡ç‚¹å‡»æ—¶é—´ï¼Œç”¨äºåŒå‡»æ£€æµ‹
        let isClosingZoom = false; // æ ‡è®°æ˜¯å¦æ­£åœ¨é€šè¿‡Ã—æŒ‰é’®å…³é—­ç¼©æ”¾

        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartTime = 0;

        // ===== æ¨¡æ€æ¡†å˜é‡ =====
        let modalScale = 1;
        let modalTranslateX = 0;
        let modalTranslateY = 0;
        let modalLastDistance = 0;
        let modalIsDragging = false;
        let modalLastTap = 0;

        // ========== è½®æ’­åŒºåŸŸäº‹ä»¶ ==========
        slider.addEventListener("touchstart", (e) => {
            isClosingZoom = false; // é‡ç½®å…³é—­æ ‡è®°

            if (e.touches.length === 2) {
                // åŒæŒ‡ç¼©æ”¾ - æš‚åœè½®æ’­
                sliderIsPinching = true;
                sliderLastDistance = getDistance(e.touches[0], e.touches[1]);
                sliderHasDragged = false; // é‡ç½®æ‹–åŠ¨æ ‡è®°
                clearInterval(timer); // æš‚åœè‡ªåŠ¨è½®æ’­
            } else if (e.touches.length === 1) {
                // å•æŒ‡
                sliderIsPinching = false;
                sliderHasDragged = false; // é‡ç½®æ‹–åŠ¨æ ‡è®°
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();

                if (sliderScale > 1.1) {
                    sliderIsDragging = true;
                    clearInterval(timer); // ç¼©æ”¾çŠ¶æ€ä¸‹æ‹–åŠ¨ä¹Ÿæš‚åœè½®æ’­
                }
            }
        });

        slider.addEventListener("touchmove", (e) => {
            if (e.touches.length === 2 && sliderIsPinching) {
                // åŒæŒ‡ç¼©æ”¾
                e.preventDefault();
                const distance = getDistance(e.touches[0], e.touches[1]);
                const ratio = distance / sliderLastDistance;
                sliderScale = Math.min(Math.max(1, sliderScale * ratio), 5);
                sliderLastDistance = distance;
                updateSliderTransform();
                sliderHasDragged = true; // æ ‡è®°è¿›è¡Œäº†æ“ä½œ
            } else if (e.touches.length === 1 && sliderIsDragging) {
                // æ‹–åŠ¨æŸ¥çœ‹ç»†èŠ‚
                e.preventDefault();
                sliderTranslateX += e.touches[0].clientX - touchStartX;
                sliderTranslateY += e.touches[0].clientY - touchStartY;
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                updateSliderTransform();
                sliderHasDragged = true; // æ ‡è®°è¿›è¡Œäº†æ‹–åŠ¨
            }
        });

        slider.addEventListener("touchend", (e) => {
            if (e.touches.length === 0) {
                // å¦‚æœæ­£åœ¨é€šè¿‡Ã—æŒ‰é’®å…³é—­ç¼©æ”¾ï¼Œè·³è¿‡æ‰€æœ‰å¤„ç†
                if (isClosingZoom) {
                    sliderIsDragging = false;
                    sliderIsPinching = false;
                    return;
                }

                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                const absDiffX = Math.abs(diffX);
                const absDiffY = Math.abs(diffY);
                const duration = Date.now() - touchStartTime;
                const currentTime = Date.now();
                const tapGap = currentTime - sliderLastTap;

                // è®°å½•è§¦æ‘¸å¼€å§‹æ—¶çš„ç¼©æ”¾çŠ¶æ€
                const wasZoomed = sliderScale > 1.1;

                // å¤„ç†ç¼©æ”¾çŠ¶æ€
                if (wasZoomed) {
                    // è§¦æ‘¸å¼€å§‹æ—¶å¤„äºç¼©æ”¾çŠ¶æ€

                    // åˆ¤æ–­æ˜¯å¦ä¸ºè½»è§¦ï¼ˆæ²¡æœ‰æ‹–åŠ¨ã€ç§»åŠ¨å¾ˆå°ã€æ—¶é—´å¾ˆçŸ­ï¼‰
                    const isTap = !sliderHasDragged && !sliderIsPinching && absDiffX < 15 && absDiffY < 15 && duration < 400;

                    if (isTap) {
                        // æ£€æµ‹æ˜¯å¦ä¸ºåŒå‡»
                        if (tapGap < 350 && tapGap > 50) {
                            // åŒå‡»ï¼šæ¢å¤åŸæ ·å¹¶ç»§ç»­è½®æ’­
                            sliderScale = 1;
                            sliderTranslateX = 0;
                            sliderTranslateY = 0;
                            updateSliderTransform();
                            startAutoPlay();
                            sliderLastTap = 0; // é‡ç½®ï¼Œé¿å…ä¸‰å‡»
                            // ä¸å†æ‰§è¡Œåç»­é€»è¾‘
                        } else {
                            // å•å‡»ï¼šè®°å½•æ—¶é—´ï¼Œç­‰å¾…å¯èƒ½çš„åŒå‡»
                            sliderLastTap = currentTime;
                            // ä¿æŒç¼©æ”¾çŠ¶æ€
                        }
                    }
                    // å¿«é€Ÿæ°´å¹³æ»‘åŠ¨ï¼ˆéæ‹–åŠ¨ï¼‰ï¼šæ¢å¤åŸæ ·å¹¶åˆ‡æ¢å›¾ç‰‡
                    else if (!sliderHasDragged && absDiffX > 80 && absDiffX > absDiffY && duration < 500) {
                        // åªæœ‰å¿«é€Ÿæ»‘åŠ¨ä¸”æ²¡æœ‰æ‹–åŠ¨æ“ä½œæ—¶æ‰åˆ‡æ¢
                        sliderScale = 1;
                        sliderTranslateX = 0;
                        sliderTranslateY = 0;
                        updateSliderTransform();

                        // åˆ‡æ¢å›¾ç‰‡
                        if (diffX > 0) {
                            showImage(index - 1);
                        } else {
                            showImage(index + 1);
                        }
                        resetTimer();
                        sliderLastTap = 0; // é‡ç½®åŒå‡»è®¡æ—¶
                    }
                    // å…¶ä»–æƒ…å†µï¼ˆåŒæŒ‡ç¼©æ”¾ç»“æŸã€æ‹–åŠ¨æŸ¥çœ‹ï¼‰ï¼šä¿æŒç¼©æ”¾ï¼Œä¸å¯åŠ¨è½®æ’­
                    else {
                        // ä¿æŒç¼©æ”¾çŠ¶æ€ï¼Œè½®æ’­ä¿æŒæš‚åœ
                        // æ‹–åŠ¨åé‡ç½®åŒå‡»è®¡æ—¶
                        if (sliderHasDragged) {
                            sliderLastTap = 0;
                        }
                    }
                } else {
                    // è§¦æ‘¸å¼€å§‹æ—¶æœªç¼©æ”¾çŠ¶æ€

                    // ç¼©æ”¾å°äº1.1è‡ªåŠ¨æ¢å¤
                    if (sliderScale <= 1.1) {
                        sliderScale = 1;
                        sliderTranslateX = 0;
                        sliderTranslateY = 0;
                        updateSliderTransform();
                    }

                    // æœªç¼©æ”¾çŠ¶æ€ä¸‹çš„æ»‘åŠ¨å’Œç‚¹å‡»
                    if (sliderScale === 1 && !sliderIsPinching) {
                        if (absDiffX > 50 && duration < 500) {
                            // æ»‘åŠ¨åˆ‡æ¢
                            if (diffX > 0) {
                                showImage(index - 1);
                            } else {
                                showImage(index + 1);
                            }
                            resetTimer();
                            sliderLastTap = 0; // é‡ç½®åŒå‡»è®¡æ—¶
                        } else if (absDiffX < 20 && absDiffY < 20 && duration < 400) {
                            // æ£€æµ‹åŒå‡»æˆ–å•å‡»
                            if (tapGap < 350 && tapGap > 50) {
                                // åŒå‡»ï¼šä¸åšå¤„ç†ï¼ˆé¿å…è¯¯è§¦å‘ï¼‰
                                sliderLastTap = 0;
                            } else if (tapGap > 350 || tapGap === 0) {
                                // å•å‡»ï¼šæ‰“å¼€æ¨¡æ€æ¡†
                                const activeImg = slider.querySelector("img.active");
                                if (activeImg) {
                                    openModal(activeImg.src);
                                }
                                sliderLastTap = currentTime;
                            }
                        }
                    }
                }

                sliderIsDragging = false;
                sliderIsPinching = false;
                // æ³¨æ„ï¼šä¸é‡ç½® sliderHasDraggedï¼Œå› ä¸ºä¸‹æ¬¡ touchstart ä¼šé‡ç½®
            }
        });

        // PCç«¯ç‚¹å‡»
        slider.addEventListener("click", (e) => {
            // åªè¦ç‚¹å‡»çš„æ˜¯å›¾ç‰‡ä¸”æœªç¼©æ”¾ï¼Œå°±æ‰“å¼€å½“å‰æ´»åŠ¨å›¾ç‰‡
            if (e.target.tagName === "IMG" && sliderScale === 1) {
                const activeImg = slider.querySelector("img.active");
                if (activeImg) {
                    openModal(activeImg.src);
                }
            }
        });

        function updateSliderTransform() {
            const activeImg = slider.querySelector("img.active");
            if (activeImg) {
                activeImg.style.transform = `translate(${sliderTranslateX}px, ${sliderTranslateY}px) scale(${sliderScale})`;
            }

            // æ ¹æ®ç¼©æ”¾çŠ¶æ€æ˜¾ç¤ºæˆ–éšè—å…³é—­æŒ‰é’®
            if (sliderScale > 1.1) {
                zoomCloseBtn.classList.add("show");
            } else {
                zoomCloseBtn.classList.remove("show");
            }
        }

        window.resetSliderZoom = function () {
            sliderScale = 1;
            sliderTranslateX = 0;
            sliderTranslateY = 0;
            sliderIsPinching = false;
            sliderIsDragging = false;
            sliderHasDragged = false;
            sliderLastTap = 0;
            updateSliderTransform(); // æ›´æ–°æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
        };

        // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆPCç«¯ï¼‰
        zoomCloseBtn.addEventListener("click", () => {
            isClosingZoom = true; // è®¾ç½®æ ‡è®°
            sliderScale = 1;
            sliderTranslateX = 0;
            sliderTranslateY = 0;
            updateSliderTransform();
            startAutoPlay(); // æ¢å¤è½®æ’­
            sliderLastTap = 0;

            // 100msåé‡ç½®æ ‡è®°
            setTimeout(() => {
                isClosingZoom = false;
            }, 100);
        });

        // é˜²æ­¢å…³é—­æŒ‰é’®çš„è§¦æ‘¸äº‹ä»¶å†’æ³¡åˆ°slider
        zoomCloseBtn.addEventListener("touchstart", (e) => {
            e.stopPropagation();
            e.preventDefault();
            isClosingZoom = true; // è®¾ç½®æ ‡è®°
        });

        zoomCloseBtn.addEventListener("touchend", (e) => {
            e.stopPropagation();
            e.preventDefault();

            // ç‚¹å‡»å…³é—­æŒ‰é’®
            sliderScale = 1;
            sliderTranslateX = 0;
            sliderTranslateY = 0;
            updateSliderTransform();
            startAutoPlay(); // æ¢å¤è½®æ’­
            sliderLastTap = 0;

            // 100msåé‡ç½®æ ‡è®°
            setTimeout(() => {
                isClosingZoom = false;
            }, 100);
        });

        // ========== æ¨¡æ€æ¡†åŠŸèƒ½ ==========
        function openModal(imgSrc) {
            modal.classList.add("show");
            modalScale = 1;
            modalTranslateX = 0;
            modalTranslateY = 0;

            // å…ˆè®¾ç½®src
            modalImg.src = imgSrc;

            // ç¡®ä¿å›¾ç‰‡å¯è§å¹¶é‡ç½®transform
            modalImg.style.opacity = "1";
            modalImg.style.visibility = "visible";
            modalImg.classList.remove("no-transition");
            updateModalTransform();

            clearInterval(timer);
        }

        function closeModal() {
            modal.classList.remove("show");
            modalScale = 1;
            modalTranslateX = 0;
            modalTranslateY = 0;
            updateModalTransform();
            startAutoPlay();
        }

        closeBtn.addEventListener("click", closeModal);
        modal.addEventListener("click", (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // PCç«¯åŒå‡»
        modalImg.addEventListener("dblclick", (e) => {
            if (modalScale === 1) {
                modalScale = 2.5;
                const rect = modalImg.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                modalTranslateX = (rect.width / 2 - x) * 1.5;
                modalTranslateY = (rect.height / 2 - y) * 1.5;
            } else {
                modalScale = 1;
                modalTranslateX = 0;
                modalTranslateY = 0;
            }
            updateModalTransform();
        });

        // æ¨¡æ€æ¡†è§¦æ‘¸äº‹ä»¶
        let modalTouchStartX = 0;
        let modalTouchStartY = 0;
        let modalIsPinching = false;

        modalImg.addEventListener("touchstart", (e) => {
            // è§¦æ‘¸å¼€å§‹æ—¶ç¦ç”¨è¿‡æ¸¡æ•ˆæœ
            modalImg.classList.add("no-transition");

            if (e.touches.length === 2) {
                // åŒæŒ‡ç¼©æ”¾
                modalIsPinching = true;
                modalLastDistance = getDistance(e.touches[0], e.touches[1]);
            } else if (e.touches.length === 1) {
                // å•æŒ‡
                modalIsPinching = false;
                modalTouchStartX = e.touches[0].clientX;
                modalTouchStartY = e.touches[0].clientY;

                if (modalScale > 1) {
                    modalIsDragging = true;
                }
            }
        });

        modalImg.addEventListener("touchmove", (e) => {
            if (e.touches.length === 2 && modalIsPinching) {
                // åŒæŒ‡ç¼©æ”¾
                e.preventDefault();
                const distance = getDistance(e.touches[0], e.touches[1]);
                const ratio = distance / modalLastDistance;
                modalScale = Math.min(Math.max(1, modalScale * ratio), 5);
                modalLastDistance = distance;
                updateModalTransform();
            } else if (modalIsDragging && e.touches.length === 1) {
                // æ‹–åŠ¨
                e.preventDefault();
                const deltaX = e.touches[0].clientX - modalTouchStartX;
                const deltaY = e.touches[0].clientY - modalTouchStartY;
                modalTranslateX += deltaX;
                modalTranslateY += deltaY;
                modalTouchStartX = e.touches[0].clientX;
                modalTouchStartY = e.touches[0].clientY;
                updateModalTransform();
            }
        });

        modalImg.addEventListener("touchend", (e) => {
            const currentTime = Date.now();
            const tapGap = currentTime - modalLastTap;

            if (e.touches.length === 0) {
                modalIsDragging = false;

                // è§¦æ‘¸ç»“æŸåç§»é™¤no-transitionç±»ï¼Œæ¢å¤è¿‡æ¸¡æ•ˆæœ
                modalImg.classList.remove("no-transition");

                // åªæœ‰çœŸçš„ç¼©å°åˆ°1ä»¥ä¸‹æ‰é‡ç½®
                if (modalScale < 1) {
                    modalScale = 1;
                    modalTranslateX = 0;
                    modalTranslateY = 0;
                    updateModalTransform();
                }

                // åŒå‡»æ£€æµ‹ï¼ˆåªåœ¨éç¼©æ”¾æ“ä½œæ—¶ï¼‰
                if (tapGap < 300 && tapGap > 0 && !modalIsPinching) {
                    if (modalScale === 1) {
                        modalScale = 2.5;
                    } else {
                        modalScale = 1;
                        modalTranslateX = 0;
                        modalTranslateY = 0;
                    }
                    updateModalTransform();
                }

                modalIsPinching = false;
            }

            // é‡ç½®åŒæŒ‡è·ç¦»
            if (e.touches.length < 2) {
                modalLastDistance = 0;
            }

            modalLastTap = currentTime;
        });

        // é¼ æ ‡æ»šè½®
        modalImg.addEventListener("wheel", (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            modalScale = Math.min(Math.max(1, modalScale * delta), 5);
            if (modalScale === 1) {
                modalTranslateX = 0;
                modalTranslateY = 0;
            }
            updateModalTransform();
        });

        // é¼ æ ‡æ‹–åŠ¨
        let mouseStartX = 0;
        let mouseStartY = 0;
        let mouseDragging = false;

        modalImg.addEventListener("mousedown", (e) => {
            if (modalScale > 1) {
                mouseDragging = true;
                mouseStartX = e.clientX - modalTranslateX;
                mouseStartY = e.clientY - modalTranslateY;
                modalImg.style.cursor = "grabbing";
                modalImg.classList.add("no-transition"); // ç¦ç”¨è¿‡æ¸¡
            }
        });

        document.addEventListener("mousemove", (e) => {
            if (mouseDragging) {
                modalTranslateX = e.clientX - mouseStartX;
                modalTranslateY = e.clientY - mouseStartY;
                updateModalTransform();
            }
        });

        document.addEventListener("mouseup", () => {
            if (mouseDragging) {
                mouseDragging = false;
                modalImg.style.cursor = modalScale > 1 ? "grab" : "default";
                modalImg.classList.remove("no-transition"); // æ¢å¤è¿‡æ¸¡
            }
        });

        function updateModalTransform() {
            // å§‹ç»ˆåº”ç”¨transformï¼Œå³ä½¿æ˜¯åˆå§‹å€¼
            const transform = `translate(${modalTranslateX}px, ${modalTranslateY}px) scale(${modalScale})`;
            modalImg.style.transform = transform;
            modalImg.style.webkitTransform = transform; // Safariå…¼å®¹
            modalImg.style.cursor = modalScale > 1 ? "grab" : "default";

            // ç¡®ä¿å›¾ç‰‡å¯è§
            modalImg.style.display = "block";
            modalImg.style.visibility = "visible";
            modalImg.style.opacity = "1";
        }
    }

    loadImages();
</script>
</body>
</html>
